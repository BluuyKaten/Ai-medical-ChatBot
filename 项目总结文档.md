# 硅谷小智（医疗版）项目总结文档

## 项目概述

### 项目名称
硅谷小智（医疗版）- AI智能医疗助手系统

### 项目简介
本项目是一个基于Spring Boot + Vue.js + LangChain4j的智能医疗助手系统，集成了多种AI大模型（阿里云百炼、OpenAI、Ollama），提供医疗咨询、智能分诊、预约挂号等功能的智能客服系统。

### 项目特色
- 🏥 **医疗专业化**：专注于医疗场景的智能助手
- 🤖 **多模型支持**：支持阿里云百炼、OpenAI、Ollama等多种AI模型
- 💬 **流式对话**：支持实时流式响应，提供更好的用户体验
- 🧠 **记忆功能**：基于MongoDB的对话记忆存储
- 🔧 **工具集成**：集成预约挂号、计算器等实用工具
- 📱 **现代化UI**：基于Element Plus的现代化前端界面

## 技术架构

### 后端技术栈
- **框架**: Spring Boot 3.2.6
- **AI框架**: LangChain4j 1.0.0-beta3
- **数据库**: MySQL 8.0 + MongoDB 6.0
- **ORM**: MyBatis Plus
- **API文档**: Knife4j (Swagger)
- **构建工具**: Maven
- **Java版本**: JDK 17

### 前端技术栈
- **框架**: Vue 3.5.13
- **UI组件库**: Element Plus 2.8.4
- **构建工具**: Vite 5.4.8
- **HTTP客户端**: Axios 1.7.7
- **工具库**: UUID 10.0.0

### AI模型支持
1. **阿里云百炼平台**
   - 聊天模型: qwen-plus
   - 嵌入模型: text-embedding-v4
   - 流式聊天模型: qwen-plus

2. **OpenAI兼容模型**
   - 模型: gpt-4o-mini
   - 支持流式响应

3. **Ollama本地模型**
   - 模型: deepseek-r1:latest
   - 本地部署，支持离线使用

## 项目结构

### 后端目录结构
```
src/main/java/com/wj/aiTest/
├── AiTestApplication.java          # 启动类
├── controller/                     # 控制器层
│   └── XiaozhiController.java     # 小智对话控制器
├── assistant/                      # AI助手接口
│   ├── Assistant.java             # 基础助手接口
│   ├── XiaozhiAgent.java         # 小智智能体
│   ├── SeparateChatAssistant.java # 分离式聊天助手
│   └── MemoryChatAssistant.java   # 记忆聊天助手
├── config/                        # 配置类
│   ├── XiaozhiAgentConfig.java   # 小智智能体配置
│   ├── EmbeddingStoreConfig.java # 向量存储配置
│   ├── SeparateChatAssistantConfig.java # 分离式助手配置
│   └── MemoryChatAssistantConfig.java   # 记忆助手配置
├── tools/                         # 工具类
│   ├── AppointmentTools.java     # 预约挂号工具
│   └── CalculatorTools.java      # 计算器工具
├── service/                       # 服务层
│   └── impl/
│       └── AppointmentServiceImpl.java # 预约服务实现
├── entity/                        # 实体类
│   └── Appointment.java          # 预约实体
├── mapper/                        # 数据访问层
│   └── AppointmentMapper.java    # 预约数据访问
├── store/                         # 存储层
│   └── MongoChatMemoryStore.java # MongoDB聊天记忆存储
└── bean/                          # 数据传输对象
    ├── ChatForm.java             # 聊天表单
    └── ChatMessages.java         # 聊天消息
```

### 前端目录结构
```
xiaozhi-ui/
├── src/
│   ├── components/
│   │   └── ChatWindow.vue       # 聊天窗口组件
│   ├── assets/
│   │   └── logo.png            # 项目logo
│   ├── App.vue                 # 主应用组件
│   ├── main.js                 # 应用入口
│   └── style.css               # 全局样式
├── public/
├── package.json                 # 依赖配置
└── vite.config.js              # Vite配置
```

## 核心功能模块

### 1. 智能对话系统
**文件**: `XiaozhiAgent.java`, `XiaozhiController.java`

**功能特点**:
- 基于LangChain4j的AI服务
- 支持流式响应
- 集成记忆功能
- 多工具集成

**核心代码**:
```java
@AiService(
    wiringMode = AiServiceWiringMode.EXPLICIT
    ,streamingChatModel = "qwenStreamingChatModel"
    ,chatMemoryProvider = "chatMemoryProvider"
    ,tools = "appointmentTools"
    ,contentRetriever = "contentRetrieverXiaozhiPincone"
)
public interface XiaozhiAgent {
    @SystemMessage(fromResource = "xiaozhi-prompt-template.txt")
    Flux<String> chat(@MemoryId Long memoryId, @UserMessage String userMessage);
}
```

### 2. 预约挂号系统
**文件**: `AppointmentTools.java`, `Appointment.java`, `AppointmentService.java`

**功能特点**:
- 智能预约挂号
- 取消预约功能
- 号源查询
- 数据持久化

**核心工具**:
```java
@Tool(name="预约挂号", value = "根据参数，先执行工具方法queryDepartment查询是否可预约...")
public String bookAppointment(Appointment appointment) {
    // 预约逻辑实现
}

@Tool(name = "取消预约挂号", value = "根据参数，查询预约是否存在...")
public String cancelAppointment(Appointment appointment) {
    // 取消预约逻辑
}

@Tool(name = "查询是否有号源", value = "根据科室名称，日期，时间和医生查询是否有号源...")
public boolean queryDepartment(String name, String date, String time, String doctorName) {
    // 号源查询逻辑
}
```

### 3. 对话记忆系统
**文件**: `MongoChatMemoryStore.java`, `ChatMessages.java`

**功能特点**:
- 基于MongoDB的持久化存储
- 支持对话历史记录
- 自动序列化/反序列化
- 内存ID管理

**核心实现**:
```java
@Component
public class MongoChatMemoryStore implements ChatMemoryStore {
    @Override
    public List<ChatMessage> getMessages(Object memoryId) {
        // 从MongoDB获取对话历史
    }
    
    @Override
    public void updateMessages(Object memoryId, List<ChatMessage> list) {
        // 更新对话历史到MongoDB
    }
}
```

### 4. 向量检索系统
**文件**: `XiaozhiAgentConfig.java`, `EmbeddingStoreConfig.java`

**功能特点**:
- 基于Pinecone的向量存储
- 语义检索
- 知识库集成
- 相似度匹配

**配置示例**:
```java
@Bean
ContentRetriever contentRetrieverXiaozhiPincone() {
    return EmbeddingStoreContentRetriever
            .builder()
            .embeddingModel(embeddingModel)
            .embeddingStore(embeddingStore)
            .maxResults(1)
            .minScore(0.8)
            .build();
}
```

### 5. 前端聊天界面
**文件**: `ChatWindow.vue`

**功能特点**:
- 实时流式对话
- 消息历史显示
- 用户友好的UI设计
- 响应式布局

**核心功能**:
- 流式消息接收
- 自动滚动
- 消息状态管理
- 会话管理

## 配置详解

### 应用配置 (application.properties)
```properties
# 基础配置
spring.application.name=aiTest

# 阿里云百炼平台配置
langchain4j.community.dashscope.chat-model.api-key=${Qwen_API_KEY}
langchain4j.community.dashscope.chat-model.model-name=qwen-plus
langchain4j.community.dashscope.embedding-model.api-key=${Qwen_API_KEY}
langchain4j.community.dashscope.embedding-model.model-name=text-embedding-v4
langchain4j.community.dashscope.streaming-chat-model.api-key=${Qwen_API_KEY}
langchain4j.community.dashscope.streaming-chat-model.model-name=qwen-plus

# 数据库配置
spring.data.mongodb.uri=mongodb://localhost:27017/chat_memory_db
spring.datasource.url=jdbc:mysql://localhost:3306/guiguxiaozhi
spring.datasource.username=root
spring.datasource.password=123456

# 日志配置
logging.level.root=info
```

### 提示词模板 (xiaozhi-prompt-template.txt)
```
你的名字是"硅谷小智"，你是一家名为"北京协和医院"的智能客服。
你是一个训练有素的医疗顾问和医疗伴诊助手。
你态度友好、礼貌且言辞简洁。

主要功能：
1. 医疗顾问：提供详细、准确且实用的医疗建议
2. AI分导诊：根据病情智能推荐科室
3. AI挂号助手：智能查询号源、预约挂号、取消挂号

规则：
- 必须获取完整的预约信息（姓名、身份证、科室、日期、时间、医生）
- 仅提供医疗相关咨询
- 在回答中包含轻松可爱的图标和表情
```

## 部署说明

### 环境要求
- JDK 17+
- Node.js 16+
- MySQL 8.0+
- MongoDB 6.0+
- Maven 3.6+

### 后端部署
1. 配置环境变量
   ```bash
   export Qwen_API_KEY=your_api_key_here
   ```

2. 配置数据库
   - MySQL: 创建数据库 `guiguxiaozhi`
   - MongoDB: 确保服务运行在 `localhost:27017`

3. 启动应用
   ```bash
   mvn spring-boot:run
   ```

### 前端部署
1. 安装依赖
   ```bash
   cd xiaozhi-ui
   npm install
   ```

2. 开发模式
   ```bash
   npm run dev
   ```

3. 生产构建
   ```bash
   npm run build
   ```

## API接口文档

### 聊天接口
- **URL**: `/xiaozhi/chat`
- **方法**: POST
- **请求体**:
  ```json
  {
    "memoryId": 123456,
    "message": "你好"
  }
  ```
- **响应**: 流式文本响应

## 项目亮点

### 1. 技术先进性
- 采用最新的Spring Boot 3.2.6和Vue 3.5.13
- 集成LangChain4j框架，支持多种AI模型
- 使用响应式编程（Reactor）处理流式数据

### 2. 架构设计
- 清晰的分层架构（Controller-Service-Mapper）
- 模块化设计，便于扩展和维护
- 配置与代码分离，便于环境切换

### 3. 用户体验
- 流式对话响应，实时反馈
- 现代化UI设计，用户友好
- 对话记忆功能，保持上下文

### 4. 功能完整性
- 医疗咨询、智能分诊、预约挂号一体化
- 多工具集成，功能丰富
- 数据持久化，支持历史查询

## 扩展建议

### 1. 功能扩展
- 添加更多医疗工具（如症状分析、用药提醒）
- 集成更多AI模型（如百度文心、讯飞星火）
- 增加语音识别和语音合成功能

### 2. 性能优化
- 添加Redis缓存层
- 实现分布式部署
- 优化向量检索性能

### 3. 安全增强
- 添加用户认证和授权
- 实现数据加密
- 增加API限流和防护

### 4. 监控运维
- 集成ELK日志系统
- 添加应用性能监控
- 实现自动化部署

## 总结

本项目是一个功能完整、技术先进的智能医疗助手系统，成功集成了多种AI模型和实用工具，为用户提供了良好的医疗咨询和预约服务体验。项目采用现代化的技术栈，具有良好的可扩展性和维护性，为后续的功能扩展和性能优化奠定了坚实的基础。

通过本项目的开发，我们深入理解了AI应用开发的全流程，包括模型集成、工具开发、前端交互、数据存储等各个环节，为后续的AI应用开发积累了宝贵的经验。 